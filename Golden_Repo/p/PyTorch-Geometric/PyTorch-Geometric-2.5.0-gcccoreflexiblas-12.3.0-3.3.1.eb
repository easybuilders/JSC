# This file is part of JSC's public easybuild repository (https://github.com/easybuilders/jsc)
easyblock = 'PythonBundle'


name = 'PyTorch-Geometric'
version = '2.5.0'
local_pytorchver = '2.1.2'

homepage = 'https://github.com/rusty1s/pytorch_geometric'
description = "PyTorch Geometric (PyG) is a geometric deep learning extension library for PyTorch."

toolchain = {'name': 'gcccoreflexiblas', 'version': '12.3.0-3.3.1'}

dependencies = [
    ('Python', '3.11.3'),
    ('CUDA', '12', '', SYSTEM),
    ('PyTorch', local_pytorchver),
    ('scikit-learn', '1.3.1'),
    ('scikit-image', '0.22.0'),
    ('numba', '0.58.1'),
    ('h5py', '3.9.0', '-serial'),
    ('tqdm', '4.66.1'),
    ('RDFlib', '7.0.0'),
    ('YACS', '0.1.8'),
]

use_pip = True

# This easyblock NEED to be installed from a compute node with gpu,
# see https://github.com/easybuilders/easybuild-easyconfigs/issues/18274
# This here is needed, but not enough:
preinstallopts = "FORCE_CUDA=1"

exts_list = [
    # ('pdm', '2.12.4', {
    #     'modulename': False,
    #     'checksums': ['d04877362f95cf9ffc1d2c38b851f693706e4928840e48986ae576dad5741496'],
    # }),
    ('googledrivedownloader', '0.4', {
        'modulename': 'google_drive_downloader',
        'checksums': ['4b34c1337b2ff3bf2bd7581818efbdcaea7d50ffd484ccf80809688f5ca0e204'],
    }),
    ('plyfile', '0.7.4', {
        'checksums': ['9e9a18d22a3158fcd74df38761d43a7facc6df75126f2ab9f4e9a5d4d2188652'],
    }),
    ('torch_scatter', '2.1.2', {
        'checksums': ['69b3aa435f2424ac6a1bfb6ff702da6eb73b33ca0db38fb26989c74159258e47'],
    }),
    ('torch_sparse', '0.6.18', {
        'checksums': ['2f14c510a6e93f404c6ea357210615b3c15a71731f9dbd86f25434e34fb5a741'],
    }),
    ('torch_cluster', '1.6.3', {
        'checksums': ['78d5a930a5bbd0d8788df8c6d66addd68d6dd292fe3edb401e3dacba26308152'],
    }),
    ('torch_spline_conv', '1.2.2', {
        'checksums': ['ed45a81da29f774665dbdd4709d7e534cdf16d2e7006dbd06957f35bd09661b2'],
    }),
    ('python-louvain', '0.16', {
        'modulename': 'community.community_louvain',
        'checksums': ['b7ba2df5002fd28d3ee789a49532baad11fe648e4f2117cf0798e7520a1da56b'],
    }),
    ('aiosignal', '1.3.1', {
        'checksums': ['54cd96e15e1649b75d6c87526a6ff0b6c1b0dd3459f43d9ca11d48c339b68cfc'],
    }),
    ('expandvars', '0.12.0', {
        'checksums': ['7d1adfa55728cf4b5d812ece3d087703faea953e0c0a1a78415de9df5024d844'],
    }),
    ('frozenlist', '1.4.1', {
        'checksums': ['c037a86e8513059a2613aaba4d817bb90b9d9b6b69aace3ce9c877e8c8ed402b'],
    }),
    ('multidict', '6.0.5', {
        'checksums': ['f7e301075edaf50500f0b341543c41194d8df3ae5caf4702f2095f3ca73dd8da'],
    }),
    ('yarl', '1.9.2', {
        'checksums': ['04ab9d4b9f587c06d801c2abfe9317b77cdf996c65a90d5e84ecc45010823571'],
    }),
    ('aiohttp', '3.9.3', {
        'checksums': ['90842933e5d1ff760fae6caca4b2b3edba53ba8f4b71e95dacf2818a2aca06f7'],
    }),
    ('torch_geometric', version, {
        'checksums': ['f4f4a57fd885c74e982d570df3a259ffff5adbb4ad7a3a95aabf5ace5fa7a240'],
    }),
]

sanity_pip_check = True

moduleclass = 'lib'
