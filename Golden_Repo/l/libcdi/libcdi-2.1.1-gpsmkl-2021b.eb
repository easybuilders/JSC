# This file is part of JSC's public easybuild repository (https://github.com/easybuilders/jsc)
easyblock = 'ConfigureMake'

name = 'libcdi'
version = '2.1.1'

homepage = 'https://gitlab.dkrz.de/mpim-sw/libcdi'
description = """
CDI is a C and Fortran Interface to access Climate model Data.
Supported data formats are GRIB, netCDF, SERVICE, EXTRA and IEG.
"""

toolchain = {'name': 'gpsmkl', 'version': '2021b'}
toolchainopts = {'pic': True, 'usempi': True}

source_urls = ['https://gitlab.dkrz.de/mpim-sw/libcdi/-/archive/cdi-%(version)s/']
sources = ['libcdi-cdi-%(version)s.tar.gz']
checksums = [
    'ba8ce82bfce159f072db027233a566f330709d750c7e4e2c275dd33e24d0f17c',  # v2.1.1.tar.gz
]
start_dir = 'libcdi-cdi-%(version)s'

builddependencies = [
    ('binutils', '2.37'),
    ('Autoconf', '2.69'),
]

dependencies = [
    ('ecCodes', '2.22.1'),
    ('netCDF', '4.8.1'),
    ('YAXT', '0.9.1'),
]

preconfigopts = "./autogen.sh && "

configopts = "--with-eccodes=yes --with-grib_api=yes --disable-cgribex "
configopts += "--with-netcdf=$EBROOTNETCDF "
configopts += "--enable-mpi "

modextravars = {'CDI_DIR': '%(installdir)s/lib/cmake/cdi/'}

sanity_check_paths = {
    'files': ['include/cdi.h', 'lib/libcdi.%s' % SHLIB_EXT],
    'dirs': [],
}

moduleclass = 'tools'
