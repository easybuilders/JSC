--- magma-2.5.4/make.check-openblas	2020-10-09 05:05:07.000000000 +0200
+++ magma-2.5.4_ok/make.check-openblas	2020-11-17 16:36:48.088614000 +0100
@@ -9,3 +9,4 @@
 ifeq ($(wildcard $(OPENBLASDIR)),)
 $(error $$OPENBLASDIR=$(OPENBLASDIR) does not exist. Please set $$OPENBLASDIR to where OPENBLAS is installed.)
 endif
+ 
--- magma-2.5.4/example/Makefile	2020-10-09 05:05:05.000000000 +0200
+++ magma-2.5.4_ok/example/Makefile	2020-11-19 11:06:33.627800000 +0100
@@ -6,9 +6,9 @@
 # Paths where MAGMA, CUDA, and OpenBLAS are installed.
 # MAGMADIR can be .. to test without installing.
 #MAGMADIR     ?= ..
-MAGMADIR     ?= /usr/local/magma
-CUDADIR      ?= /usr/local/cuda
-OPENBLASDIR  ?= /usr/local/openblas
+MAGMADIR     = $(EBROOTMAGMA)
+CUDADIR      = $(EBROOTCUDA)
+#OPENBLASDIR  ?= /usr/local/openblas
 
 CC            = gcc
 FORT          = gfortran
@@ -20,28 +20,28 @@
 
 # ----------------------------------------
 # Flags and paths to MAGMA, CUDA, and LAPACK/BLAS
-# MAGMA_CFLAGS     := -DADD_ \
-#                     -I$(MAGMADIR)/include \
-#                     -I$(MAGMADIR)/sparse/include \
-#                     -I$(CUDADIR)/include
-# 
-# MAGMA_F90FLAGS   := -Dmagma_devptr_t="integer(kind=8)" \
-#                     -I$(MAGMADIR)/include
-# 
+MAGMA_CFLAGS     := -DADD_ \
+                    -I$(MAGMADIR)/include \
+                    -I$(MAGMADIR)/sparse/include \
+                    -I$(CUDADIR)/include
+ 
+MAGMA_F90FLAGS   := -Dmagma_devptr_t="integer(kind=8)" \
+                    -I$(MAGMADIR)/include
+ 
 # # may be lib instead of lib64 on some systems
-# MAGMA_LIBS       := -L$(MAGMADIR)/lib -lmagma_sparse -lmagma \
-#                     -L$(CUDADIR)/lib64 -lcublas -lcudart -lcusparse \
-#                     -L$(OPENBLASDIR)/lib -lopenblas
+MAGMA_LIBS       := -L$(MAGMADIR)/lib -lmagma_sparse -lmagma \
+                    -L$(CUDADIR)/lib64 -lcublas -lcudart -lcusparse \
+                    -lmkl_gf_lp64 -lmkl_sequential -lmkl_core -lm
 
 
 # ----------------------------------------
 # Alternatively, using pkg-config (see README.txt):
-MAGMA_CFLAGS   := $(shell pkg-config --cflags magma)
+#MAGMA_CFLAGS   := $(shell pkg-config --cflags magma)
 
-MAGMA_F90FLAGS := -Dmagma_devptr_t="integer(kind=8)" \
-                  $(shell pkg-config --cflags-only-I magma)
+#MAGMA_F90FLAGS := -Dmagma_devptr_t="integer(kind=8)" \
+#                  $(shell pkg-config --cflags-only-I magma)
 
-MAGMA_LIBS     := $(shell pkg-config --libs   magma)
+#MAGMA_LIBS     := $(shell pkg-config --libs   magma)
 
 
 # ----------------------------------------
@@ -88,5 +88,8 @@
 %.o: %.F90
 	$(FORT) $(F90FLAGS) $(MAGMA_F90FLAGS) -c -o $@ $<
 
-example_f: example_f.o
+fortran.o: $(CUDADIR)/src/fortran.c
+	$(CC) $(CFLAGS) $(MAGMA_CFLAGS) -DCUBLAS_GFORTRAN -c -o $@ $<
+ 
+example_f: example_f.o fortran.o
 	$(FORT) $(LDFLAGS) -o $@ $^ $(MAGMA_LIBS)
