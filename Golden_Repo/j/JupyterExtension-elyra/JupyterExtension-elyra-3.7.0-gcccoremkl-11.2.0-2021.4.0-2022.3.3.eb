# This file is part of JSC's public easybuild repository (https://github.com/easybuilders/jsc)
easyblock = 'PythonBundle'

name = 'JupyterExtension-elyra'
version = '3.7.0'
local_jupyterver = '2022.3.3'
versionsuffix = '-' + local_jupyterver

homepage = 'https://elyra.readthedocs.io'
description = """
A JupyterLab extension for handling pipelines
"""

toolchain = {'name': 'gcccoremkl', 'version': '11.2.0-2021.4.0'}
toolchainopts = {'pic': True}

builddependencies = [
    ('binutils', '2.37'),
]

dependencies = [
    ('Python', '3.9.6'),
    ('protobuf-python', '3.17.3'),
    ('Jupyter', '2022.3.3'),
]

# this is a bundle of Python packages
exts_defaultclass = 'PythonPackage'
exts_default_options = {
    'filter': ('python -c "import %(ext_name)s"', ''),
    'download_dep_fail': True,
    'source_urls': [PYPI_SOURCE],
    'use_pip': True,
    'sanity_pip_check':  True,
}

exts_list = [
    ('httplib2', '0.20.4', {
        'checksums': ['58a98e45b4b1a48273073f905d2961666ecf0fbac4250ea5b47aef259eb5c585'],
    }),
    ('rsa', '4.8', {
        'checksums': ['5c6bd9dc7a543b7fe4304a631f8a8a3b674e2bbfc49c2ae96200cdbe55df6b17'],
    }),
    ('google-crc32c', '1.3.0', {
        'checksums': ['276de6273eb074a35bc598f8efbc00c7869c5cf2e29c90748fccc8c898c244df'],
        'modulename': 'google',
    }),
    ('google-resumable-media', '2.3.2', {
        'checksums': ['06924e8b1e79f158f0202e7dd151ad75b0ea9d59b997c850f56bdd4a5a361513'],
        'modulename': 'google',
    }),
    ('googleapis-common-protos', '1.56.0', {
        'checksums': ['4007500795bcfc269d279f0f7d253ae18d6dc1ff5d5a73613ffe452038b1ec5f'],
        'modulename': 'google',
    }),
    ('google-auth', '1.35.0', {
        'checksums': ['b7033be9028c188ee30200b204ea00ed82ea1162e8ac1df4aa6ded19a191d88e'],
        'modulename': 'google.auth',
    }),
    ('google-auth-httplib2', '0.1.0', {
        'checksums': ['a07c39fd632becacd3f07718dfd6021bf396978f03ad3ce4321d060015cc30ac'],
        'modulename': 'google.auth',
    }),
    ('google-api-python-client', '1.12.11', {
        'checksums': ['1b4bd42a46321e13c0542a9e4d96fa05d73626f07b39f83a73a947d70ca706a9'],
        'modulename': 'google',
    }),
    ('google-cloud-core', '2.2.3', {
        'checksums': ['89d2f7189bc6dc74de128d423ea52cc8719f0a5dbccd9ca80433f6504a20255c'],
        'modulename': 'google',
    }),
    ('google-cloud-storage', '1.44.0', {
        'checksums': ['29edbfeedd157d853049302bf5d104055c6f0cb7ef283537da3ce3f730073001'],
        'modulename': 'google',
    }),
    ('google-api-core', '2.7.1', {
        'checksums': ['b0fa577e512f0c8e063386b974718b8614586a798c5894ed34bedf256d9dae24'],
        'modulename': 'google',
    }),
    ('pydantic', '1.9.0', {
        'checksums': ['742645059757a56ecd886faf4ed2441b9c0cd406079c2b4bee51bcc3fbcd510a'],
    }),
    ('uritemplate', '3.0.1', {
        'checksums': ['5af8ad10cec94f215e3f48112de2022e1d5a37ed427fbd88652fa908f2ab7cae'],
    }),
    ('termcolor', '1.1.0', {
        'checksums': ['1d6d69ce66211143803fbc56652b41d73b4a400a2891d7bf7a1cdf4c02de613b'],
    }),
    ('fire', '0.4.0', {
        'checksums': ['c5e2b8763699d1142393a46d0e3e790c5eb2f0706082df8f647878842c216a62'],
    }),
    ('Deprecated', '1.2.13', {
        'checksums': ['43ac5335da90c31c24ba028af536a91d41d53f9e6901ddb021bcc572ce44e38d'],
        'modulename': 'deprecated',
    }),
    ('docstring_parser', '0.13', {
        'checksums': ['66dd7eac7232202bf220fd98a5f11491863c01f958a75fdd535c7eccac9ced78'],
    }),
    ('typer', '0.4.1', {
        'checksums': ['5646aef0d936b2c761a10393f0384ee6b5c7fe0bb3e5cd710b17134ca1d99cff'],
    }),
    ('strip-hints', '0.1.10', {
        'checksums': ['307c2bd147cd35997c8ed2e9a3bdca48ad9c9617e04ea46599095201b4ce998f'],
    }),
    ('kfp_pipeline_spec', '0.1.14', {
        'checksums': ['bf9bdb244688b5084e75fc733a1a0855ee7ae789b8f5c8d82c6a5032762accba'],
        'source_tmpl': 'kfp_pipeline_spec-0.1.14-py3-none-any.whl',
        'unpack_sources': False,
        'modulename': False,
    }),
    ('kfp-server-api', '1.8.1', {
        'checksums': ['8057c4835a1685598cf3077f86b711a02dc5085f0d87f96a49b43c1fbfc263ec'],
    }),
    ('kfp', '1.8.12', {
        'checksums': ['3d6e1c6faaa99de13cfab3d1997f3b6d92d4458af814d19e88d3eb9cd711f131'],
    }),
    ('requests-oauthlib', '1.3.1', {
        'checksums': ['75beac4a47881eeb94d5ea5d6ad31ef88856affe2332b9aafb52c6452ccf0d7a'],
    }),
    ('kubernetes', '18.20.0', {
        'checksums': ['0c72d00e7883375bd39ae99758425f5e6cb86388417cf7cc84305c211b2192cf'],
    }),
    ('minio', '7.1.5', {
        'checksums': ['f33bb3d2a1b790d6ffc7b981c3f38c4f404d61c46de3cbd087fbf9d36a5f05ea'],
    }),
    ('watchdog', '2.1.7', {
        'checksums': ['3fd47815353be9c44eebc94cc28fe26b2b0c5bd889dafc4a5a7cbdf924143480'],
    }),
    ('PyGithub', '1.55', {
        'checksums': ['1bbfff9372047ff3f21d5cd8e07720f3dbfdaf6462fcaed9d815f528f1ba7283'],
        'modulename': 'github',
    }),
    ('yaspin', '2.1.0', {
        'checksums': ['c8d34eca9fda3f4dfbe59f57f3cf0f3641af3eefbf1544fbeb9b3bacf82c580a'],
    }),
    ('rfc3986_validator', '0.1.1', {
        'checksums': ['3d44bde7921b3b9ec3ae4e3adca370438eccebc676456449b145d533b240d055'],
    }),
    ('elyra-server', '3.7.0', {
        'checksums': ['bb31e66a5a6c6a9adf12d2f85386b3841c7faf9beffb96e05835136a44c9df8d'],
        'modulename': 'elyra',
    }),
    ('elyra-pipeline-editor-extension', '3.7.0', {
        'checksums': ['863748f6bf1ba823ae97a1664c49c3a815e95244c7412136293a30bb4793a64c'],
        'modulename': 'elyra.pipeline',
    }),
]

postinstallcmds = [
    (
        # clean unwanted extensions
        'rm %(installdir)s/etc/jupyter/jupyter_notebook_config.d/jupyterlab_git.json & '
        'rm %(installdir)s/etc/jupyter/jupyter_notebook_config.d/jupyter_resource_usage.json & '
        'rm %(installdir)s/etc/jupyter/jupyter_server_config.d/jupyterlab_git.json & '
        'rm %(installdir)s/etc/jupyter/jupyter_server_config.d/jupyter_resource_usage.json & '
        'rm -rf %(installdir)s/share/jupyter/labextensions/\@elyra/theme-extension/ & '
        'rm -rf %(installdir)s/share/jupyter/lab/ & '
    )
]

modextrapaths = {
    'JUPYTER_EXTRA_LABEXTENSIONS_PATH': ['share/jupyter/labextensions'],
    'JUPYTER_PATH': ['share/jupyter'],
    'JUPYTER_CONFIG_PATH': ['etc/jupyter'],
}

# Ensure that the user-specific $HOME/.local/share/jupyter is always first entry in JUPYTHER_PATH
modluafooter = """
prepend_path("JUPYTER_PATH", pathJoin(os.getenv("HOME"), ".local/share/jupyter"))
"""

sanity_check_paths = {
    'files': [],
    'dirs': [
        'share/jupyter/labextensions',
        'lib/python%(pyshortver)s/site-packages'
    ],
}

moduleclass = 'tools'
